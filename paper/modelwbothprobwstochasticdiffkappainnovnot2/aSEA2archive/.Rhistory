b$aggu12 <- ifelse(b$year  == "2005",1,0)
b$aggu13 <- ifelse(b$year  == "2006",1,0)
b$aggu14 <- ifelse(b$year  == "2007",1,0)
b$aggu15 <- ifelse(b$year  == "2008",1,0)
b$aggu16 <- ifelse(b$year  == "2009",1,0)
b$aggu17 <- ifelse(b$year  == "2010",1,0)
b$aggu18 <- ifelse(b$year  == "2011",1,0)
b$aggu19 <- ifelse(b$year  == "2012",1,0)
b$aggu20 <- ifelse(b$year  == "2013",1,0)
b$aggu21 <- ifelse(b$year  == "2014",1,0)
# 2) Selfemployment
# Consider that if selfemp == 1, change lfstat into selfemp
b$lfsta_emp = ifelse(b$selftot == "1", "Self Employed", b$lfstat)
# b$lfsta_emp = ifelse(b$schenr == " 0", "In education", b$lfsta_emp)
# table(b$lfsta_emp)
# table(b$lfsta_emp, b$lfstat)
# b$lfsta_emp = ifelse(b$selftot, "Self Employed", b$lfsta_emp) # broader definition of self employed
b$educ2222[b$educ2 %in% c(1,2,3,4,5,6,7,8)] <- 1
b$educ2222[b$educ2 %in% c(9)] <- 2
b$educ2222[b$educ2 %in% c(10)] <- 3
b$educ2222[b$educ2 %in% c(11,12)] <- 4
b$educ2222[b$educ2 %in% c(13)] <- 5
b$educ2222[b$educ2 %in% c(14,15,16)] <- 6
b$age <- as.numeric(b$age)
x = seq(22, 60, by=1)
b$worker <- ifelse(b$lfstat == "Employed", 1, 0)
workers <- b[which(b$worker == 1),]
workers$wage <- as.numeric(workers$wage1)
workers$wage <- ifelse(workers$wage == 0, NA, workers$wage)
avgwage1 = c()
avgwage2 = c()
avgwage3 = c()
avgwage4 = c()
avgwage5 = c()
avgwage6 = c()
varwage = c()
for(i in 1:38) {
avgwage1[i] = mean(log(workers$wage[workers$educ2222 == 1 & workers$age == (i+21)]), na.rm = TRUE)
avgwage2[i] = mean(log(workers$wage[workers$educ2222 == 2 & workers$age == (i+21)]), na.rm = TRUE)
avgwage3[i] = mean(log(workers$wage[workers$educ2222 == 3 & workers$age == (i+21)]), na.rm = TRUE)
avgwage4[i] = mean(log(workers$wage[workers$educ2222 == 4 & workers$age == (i+21)]), na.rm = TRUE)
avgwage5[i] = mean(log(workers$wage[workers$educ2222 == 5 & workers$age == (i+21)]), na.rm = TRUE)
avgwage6[i] = mean(log(workers$wage[workers$educ2222 == 6 & workers$age == (i+21)]), na.rm = TRUE)
avgwage =c(avgwage1[i], avgwage2[i], avgwage3[i], avgwage4[i], avgwage5[i], avgwage6[i])
varwage[i] = var(avgwage)
}
var1 = var(avgwage1)
var2 = var(avgwage2)
var3 = var(avgwage3)
var4 = var(avgwage4)
var5 = var(avgwage5)
var6 = var(avgwage6)
varwithin = c(var1,var2,var3,var4,var5,var6)
lfsta_emp = b$lfsta_emp
table(lfsta_emp)
lfsta_emp1 = lfsta_emp[2:length(lfsta_emp)]
lfsta_emp = lfsta_emp[1:(length(lfsta_emp) - 1)]
corresp_id = b$unique_id[1:(nrow(b) - 1)]
corresp_id = corresp_id[seq(1, length(corresp_id), by=2)]
lfsta_emp = lfsta_emp[seq(1, length(lfsta_emp), by=2)]
lfsta_emp1 = lfsta_emp1[seq(1, length(lfsta_emp1), by=2)] # do not select the relations from 1 guy to another, this way only have transitions of the same guy
# Remark: if selected more years (like 3), then do: by = 3, etc.
lfsta_emp = cbind(lfsta_emp, lfsta_emp1)
trans = as.data.frame.matrix(table(lfsta_emp[,1], lfsta_emp[,2]))
# a) Raw transition matrix
trans
nbNA = sum(trans[2,])/(sum(trans))
nbscale = 1 - trans[3,2]/sum(trans[3,])
Xscale = 1/(1 - nbNA)
# b) Transition matrix with NA
TRANS1 = trans
rowsums = rowSums(TRANS1)
for(i in 1:length(rowsums)) TRANS1[i, ] = TRANS1[i, ]/rowsums[i]
TRANS1
# c) Transition matrix without NILF
TRANS2 = trans[-2, -2]
rowsums = rowSums(TRANS2)
for(i in 1:length(rowsums)) TRANS2[i, ] = TRANS2[i, ]/rowsums[i]
TRANS2
# 2) Focus on the ones transitioning from SE to WW:
corresp_id = b$unique_id[1:(nrow(b) - 1)]
corresp_id = corresp_id[seq(1, length(corresp_id), by=2)]
selected_id = corresp_id[which(lfsta_emp[,1] == "Self Employed" & lfsta_emp[,2] == "Employed")]
b$SEtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed")]
EE = b[which(b$unique_id %in% selected_id2 & b$year_id == 1),]
# model10 <- lm(SEtoWW ~ as.numeric(female) + as.numeric(age) + as.numeric(married) +  as.numeric(finc) + I(as.numeric(finc)^2) + I(as.numeric(finc)^3)  + aggu2 + aggu3 + aggu4 + aggu5 + aggu6 + aggu7 + aggu8 + aggu9 + aggu10 + aggu11 + aggu12 + aggu13 + aggu14 + aggu15 + aggu16 + aggu17 + aggu18 + aggu19 + aggu20 + aggu21, data=EE,weights=as.numeric(fnlwgt))
# summary(model10)
# fitted = model10$coefficients[5]*as.numeric(EE$finc) + model10$coefficients[6]*I(as.numeric(EE$finc)^2) + model10$coefficients[7]*I(as.numeric(EE$finc)^3)
# plot(as.numeric(EE$finc), fitted, type="p")
# model10educ <- lm(SEtoWW ~ as.numeric(female) + as.numeric(age) + as.numeric(married) +  as.numeric(educ222) + I(as.numeric(educ222)^2) + I(as.numeric(educ222)^3) + aggu2 + aggu3 + aggu4 + aggu5 + aggu6 + aggu7 + aggu8 + aggu9 + aggu10 + aggu11 + aggu12 + aggu13 + aggu14 + aggu15 + aggu16 + aggu17 + aggu18 + aggu19 + aggu20 + aggu21, data=EE,weights=as.numeric(fnlwgt))
# summary(model10educ)
# modelEWWlm <- lm(SEtoWW ~  as.numeric(female) + as.numeric(age) + as.numeric(married) + as.numeric(finc) + I(as.numeric(finc)^2) + I(as.numeric(finc)^3),data=EE, weights=as.numeric(fnlwgt))
# summary(modelEWWlm)
# modelEWWlm2 <- lm(SEtoWW ~  as.numeric(female) + as.numeric(age) + educd2 + educd3 + educd4 + educd5 + educd6 + aggu2 + aggu3 + aggu4 + aggu5 + aggu6 + aggu7 + aggu8 + aggu9 + aggu10 + aggu11 + aggu12 + aggu13 + aggu14 + aggu15 + aggu16 + aggu17 + aggu18 + aggu19 + aggu20 + aggu21,data=EE, weights=as.numeric(fnlwgt))
# summary(modelEWWlm2)
# modelEWWlm2 <- lm(SEtoWW ~  as.numeric(female) + as.numeric(age) + finc2 + finc3 + finc4 + finc5 + finc6,data=EE, weights=as.numeric(fnlwgt))
# summary(modelEWWlm2)
# summary(lm(SEtoWW ~ as.numeric(finc) + I(as.numeric(finc)^2) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + I(as.numeric(educ22)^2),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(SEtoWW ~ as.numeric(finc) + I(as.numeric(finc)^2) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + I(as.numeric(educ22)^2), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
head(D)
D2 = D[which(D$year_id == 2 & !is.na(D$educ222)),]
tab1 = table(D2$educ222)
selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
SEtoEMP = b[which(b$unique_id %in% selected_id2 & !is.na(b$educ222)),]
tab2 = table(SEtoEMP$educ222)
SEtoWWeduc = (tab1/tab2)*Xscale
D = b[which(b$unique_id %in% selected_id),]
head(D)
D2 = D[which(D$year_id == 2),]
tab1 = table(D2$finc)
selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
SEtoEMP = b[which(b$unique_id %in% selected_id2),]
tab2 = table(SEtoEMP$finc)
SEtoWWfinc = (tab1/tab2)*Xscale
#
# D = b[which(b$unique_id %in% selected_id),]
# head(D)
# D2 = D[which(D$year_id == 2),]
# tab1 = table(D2$educ22)
#
# selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
# #UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
# SEtoEMP = b[which(b$unique_id %in% selected_id2),]
# tab2 = table(SEtoEMP$educ22)
#
# SEtoWWeduc22 = tab1/tab2
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Self Employed")]
b$UtoSE = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoSE ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoSE ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoSEeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoSEfinc = tab1/tab2
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Employed")]
b$UtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoWW ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoWW ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoWWeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoWWfinc = tab1/tab2
selected_id = corresp_id[which(lfsta_emp[,1] == "Employed" & lfsta_emp[,2] == "Unemployed")]
b$WWtoU = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(WWtoU ~ as.numeric(wage1) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22), data=b,weights=as.numeric(fnlwgt)))
# summary(glm(WWtoU ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$educ222)
EtoUeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$finc)
EtoUfinc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$wagelvl)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$wagelvl)
EtoUwagelvl = tab1/tab2
# 4) Worker to Self Employed by education
selected_id = corresp_id[which(lfsta_emp[,1] == "Employed" & lfsta_emp[,2] == "Self Employed")]
b$WWtoSE = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(WWtoSE ~ as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + I(as.numeric(educ22)^2), data=b,weights=as.numeric(fnlwgt)))
# summary(lm(WWtoSE ~ as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(wage1) + I(as.numeric(wage1)^2), data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$educ22)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$educ22)
EtoSEeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$finc)
EtoSEfinc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$wagelvl)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$wagelvl)
EtoSEwagelvl = tab1/tab2
# 4) Worker to Self Employed by education
selected_id = corresp_id[which(lfsta_emp[,1] == "Self Employed" & lfsta_emp[,2] == "Unemployed")]
b$SEtoU = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(SEtoU ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22), data=b,weights=as.numeric(fnlwgt)))
# summary(lm(SEtoU ~ as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22), data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$educ222)
SEtoUeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
EMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(EMP$finc)
SEtoUfinc = tab1/tab2
fracEtoW = c(0.002454160288361,	   0.003429923947575,	   0.003963703946223,	   0.004072664247018, 0.00211250180815)
fracE = c(0.011338390798845,	   0.015563438967765,	   0.017315842096545,	   0.016867938609277,	   0.010487689861394)
fracWtoE = c(0.001723394585433,	   0.002590429037301,	   0.003500297164246,	   0.004025771314074,	   0.004609154142540)
fracW = c(0.124965617359970,	   0.157569199824146,	   0.164170576232099,	   0.156264700182633,	   0.125816318297421)
CD2006WtoE = fracWtoE/fracW
CD2006EtoW = fracEtoW/fracE
labelseduc = c("<HS","HS","<C","C(B)","C(M)",">C")
names(EtoSEeduc) <- labelseduc
names(EtoUeduc) <- labelseduc
names(UtoWWeduc) <- labelseduc
names(UtoSEeduc) <- labelseduc
names(SEtoWWeduc) <- labelseduc
names(SEtoUeduc) <- labelseduc
names(EtoSEwagelvl) <- seq(1,7,by=1)
names(EtoUwagelvl) <- seq(1,7,by=1)
par(mfrow=c(3,2))
fit <- glm(EtoSEfinc~ seq(1,7,by=1) + I(seq(1,7,by=1)^2))
co <- coef(fit)
plot(EtoSEeduc, type="o", col="grey", lty=5, ylim=c(0.01, 0.037), main="W to E", ylab="% of each W group")
par(new=TRUE)
plot(seq(1,5, by=1),CD2006WtoE, ylim=c(0.01, 0.037), type="l", lty=5, col="blue", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
par(new=TRUE)
plot(EtoSEfinc, type="o", ylim=c(0.01, 0.037), lty=1, col="grey", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
par(new=TRUE)
plot(EtoSEwagelvl, type="o", ylim=c(0.01, 0.037), lty=1, col="black", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
par(new=TRUE)
plot(seq(1,3,by=1),c(0.028119838271323,0.021363863890270,0.029101988088726), type="l", ylim=c(0.01, 0.037), lty=5, col="red", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
legend("bottomright", cex=0.8, bty="n", c("CD model (2006)", "Data (Yr. Schooling)", "Data (Family Income)", "Data (Wage)", "Benchmark"), lty=c(5,5,1,1,5), col=c("blue","grey","grey","black", "red"))
at3<- seq(from = 1, to = 7, by = 1)
axis(1,line=2.2,at=at3,labels=c("<10", "10-15", "15-25", "25-35", "35-50", "50-75", ">75"),tick=TRUE)
mtext("HH Inc",1,line=2.2,at=0.1, cex=0.7)
mtext("Schooling",1,line=0.5,at=0.1, cex=0.7)
mtext("Schooling",1,line=0.5,at=0.5, cex=0.7)
mtext("HH Inc",1,line=2.2,at=0.5, cex=0.7)
mtext("Schooling",1,line=0.5,at=0.5, cex=0.7)
mtext("Schooling",1,line=0.5,at=1, cex=0.7)
mtext("HH Inc",1,line=2.2,at=1, cex=0.7)
mtext("HH Inc",1,line=2.2,at=0.8, cex=0.7)
mtext("Schooling",1,line=0.5,at=0.8, cex=0.7)
mtext("Schooling",1,line=0.5,at=0.83, cex=0.7)
setwd("/Users/alexandregaillard/Documents/Thesis/EntrepreneurshipUnemployment/Self-EmploymentUnemploymentEmployment/Codefinal/modelwbothprobwstochasticdiffkappainnovnot2/aSEA2")
transVEtoWW = read.table("disttransitionVEtoWW.out", sep="\t", header=TRUE)
distVE= read.table("distVE.out", sep="\t", header=TRUE)
plot(SEtoUeduc, type="o", ylim=c(0.005, 0.05), lty=5, col="grey", main="E to U", ylab="% of each E group")
par(new=TRUE)
plot(SEtoUfinc, type="o", ylim=c(0.005, 0.05), lty=1, col="black", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
par(new=TRUE)
plot(seq(1,3,by=1),c(0.044478299111313,0.030779622332926,0.022394612073714), type="l", ylim=c(0.005, 0.05), lty=5, col="red", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
plot(seq(1,3,by=1),c(0.044478299111313,0.030779622332926,0.022394612073714), type="l", ylim=c(0.005, 0.05), lty=5, col="red", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
plot(SEtoUeduc, type="o", ylim=c(0.005, 0.05), lty=5, col="grey", main="E to U", ylab="% of each E group")
par(new=TRUE)
plot(SEtoUfinc, type="o", ylim=c(0.005, 0.05), lty=1, col="black", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
par(new=TRUE)
plot(seq(1,3,by=1),c(0.044478299111313,0.030779622332926,0.022394612073714), type="l", ylim=c(0.005, 0.05), lty=5, col="red", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
legend("topright", cex=0.8, bty="n", c("Data (Yr. Schooling)", "Data (Family Income)", "Benchmark"), lty=c(5,1), col=c("grey","black","red"))
at3<- seq(from = 1, to = 7, by = 1)
axis(1,line=2.2,at=at3,labels=c("<10", "10-15", "15-25", "25-35", "35-50", "50-75", ">75"),tick=TRUE)
mtext("HH Inc",1,line=2.2,at=0.7, cex=0.7)
mtext("Schooling",1,line=0.5,at=0.7, cex=0.7)
plot(seq(1,3,by=1),c(0.044478299111313,0.030779622332926,0.022394612073714), type="l", ylim=c(0.005, 0.05), lty=5, col="red", yaxt="n", xaxt='n', ann=FALSE, frame.plot =FALSE)
lfsta_emp = b$lfsta_emp
table(lfsta_emp)
lfsta_emp1 = lfsta_emp[2:length(lfsta_emp)]
lfsta_emp = lfsta_emp[1:(length(lfsta_emp) - 1)]
corresp_id = b$unique_id[1:(nrow(b) - 1)]
corresp_id = corresp_id[seq(1, length(corresp_id), by=2)]
lfsta_emp = lfsta_emp[seq(1, length(lfsta_emp), by=2)]
lfsta_emp1 = lfsta_emp1[seq(1, length(lfsta_emp1), by=2)] # do not select the relations from 1 guy to another, this way only have transitions of the same guy
lfsta_emp = cbind(lfsta_emp, lfsta_emp1)
trans = as.data.frame.matrix(table(lfsta_emp[,1], lfsta_emp[,2]))
trans
nbNA = sum(trans[2,])/(sum(trans))
nbscale = 1 - trans[3,2]/sum(trans[3,])
Xscale = 1/(1 - nbNA)
TRANS1 = trans
rowsums = rowSums(TRANS1)
for(i in 1:length(rowsums)) TRANS1[i, ] = TRANS1[i, ]/rowsums[i]
TRANS1
TRANS2 = trans[-2, -2]
rowsums = rowSums(TRANS2)
for(i in 1:length(rowsums)) TRANS2[i, ] = TRANS2[i, ]/rowsums[i]
TRANS2
corresp_id = b$unique_id[1:(nrow(b) - 1)]
corresp_id = b$unique_id[1:(nrow(b) - 1)]
corresp_id = corresp_id[seq(1, length(corresp_id), by=2)]
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Employed")]
b$UtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoWWeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoWWfinc = tab1/tab2
UtoWWfinc
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 2)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoWWeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 2)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoWWfinc = tab1/tab2
UtoWWfinc
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Employed")]
b$UtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoWW ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoWW ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoWWeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoWWfinc = tab1/tab2
UtoWWfinc
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Self Employed")]
b$UtoSE = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoSE ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoSE ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoSEeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoSEfinc = tab1/tab2
UtoSEfinc
UtoSEeduc
UtoWWeduc
UtoWWfinc
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Employed")]
b$UtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoWW ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoWW ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 2)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoWWeduc = tab1/tab2
UtoWWeduc
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 2)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoWWfinc = tab1/tab2
UtoWWfinc
selected_id = corresp_id[which(lfsta_emp[,1] == "Self Employed" & lfsta_emp[,2] == "Employed")]
b$SEtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed")]
EE = b[which(b$unique_id %in% selected_id2 & b$year_id == 1),]
# model10 <- lm(SEtoWW ~ as.numeric(female) + as.numeric(age) + as.numeric(married) +  as.numeric(finc) + I(as.numeric(finc)^2) + I(as.numeric(finc)^3)  + aggu2 + aggu3 + aggu4 + aggu5 + aggu6 + aggu7 + aggu8 + aggu9 + aggu10 + aggu11 + aggu12 + aggu13 + aggu14 + aggu15 + aggu16 + aggu17 + aggu18 + aggu19 + aggu20 + aggu21, data=EE,weights=as.numeric(fnlwgt))
# summary(model10)
# fitted = model10$coefficients[5]*as.numeric(EE$finc) + model10$coefficients[6]*I(as.numeric(EE$finc)^2) + model10$coefficients[7]*I(as.numeric(EE$finc)^3)
# plot(as.numeric(EE$finc), fitted, type="p")
# model10educ <- lm(SEtoWW ~ as.numeric(female) + as.numeric(age) + as.numeric(married) +  as.numeric(educ222) + I(as.numeric(educ222)^2) + I(as.numeric(educ222)^3) + aggu2 + aggu3 + aggu4 + aggu5 + aggu6 + aggu7 + aggu8 + aggu9 + aggu10 + aggu11 + aggu12 + aggu13 + aggu14 + aggu15 + aggu16 + aggu17 + aggu18 + aggu19 + aggu20 + aggu21, data=EE,weights=as.numeric(fnlwgt))
# summary(model10educ)
# modelEWWlm <- lm(SEtoWW ~  as.numeric(female) + as.numeric(age) + as.numeric(married) + as.numeric(finc) + I(as.numeric(finc)^2) + I(as.numeric(finc)^3),data=EE, weights=as.numeric(fnlwgt))
# summary(modelEWWlm)
# modelEWWlm2 <- lm(SEtoWW ~  as.numeric(female) + as.numeric(age) + educd2 + educd3 + educd4 + educd5 + educd6 + aggu2 + aggu3 + aggu4 + aggu5 + aggu6 + aggu7 + aggu8 + aggu9 + aggu10 + aggu11 + aggu12 + aggu13 + aggu14 + aggu15 + aggu16 + aggu17 + aggu18 + aggu19 + aggu20 + aggu21,data=EE, weights=as.numeric(fnlwgt))
# summary(modelEWWlm2)
# modelEWWlm2 <- lm(SEtoWW ~  as.numeric(female) + as.numeric(age) + finc2 + finc3 + finc4 + finc5 + finc6,data=EE, weights=as.numeric(fnlwgt))
# summary(modelEWWlm2)
# summary(lm(SEtoWW ~ as.numeric(finc) + I(as.numeric(finc)^2) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + I(as.numeric(educ22)^2),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(SEtoWW ~ as.numeric(finc) + I(as.numeric(finc)^2) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + I(as.numeric(educ22)^2), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
head(D)
D2 = D[which(D$year_id == 1 & !is.na(D$educ222)),]
tab1 = table(D2$educ222)
selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
SEtoEMP = b[which(b$unique_id %in% selected_id2 & !is.na(b$educ222)),]
tab2 = table(SEtoEMP$educ222)
SEtoWWeduc = (tab1/tab2)*Xscale
D = b[which(b$unique_id %in% selected_id),]
head(D)
D2 = D[which(D$year_id == 1),]
tab1 = table(D2$finc)
selected_id2 = corresp_id[which(lfsta_emp[,1] == "Self Employed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
SEtoEMP = b[which(b$unique_id %in% selected_id2),]
tab2 = table(SEtoEMP$finc)
SEtoWWfinc = (tab1/tab2)*Xscale
SEtoWWfinc
SEtoWWeduc
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Self Employed")]
b$UtoSE = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoSE ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoSE ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 2 & !is.na(D$educ222)),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoSEeduc = tab1/tab2
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1 & !is.na(D$educ222)),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoSEfinc = tab1/tab2
UtoSEfinc
selected_id = corresp_id[which(lfsta_emp[,1] == "Unemployed" & lfsta_emp[,2] == "Employed")]
b$UtoWW = ifelse(b$unique_id %in% selected_id, 1, 0)
# summary(lm(UtoWW ~ as.numeric(finc)  + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur),data=b,weights=as.numeric(fnlwgt)))
# summary(glm(UtoWW ~ as.numeric(finc) + as.numeric(married) + as.numeric(female) + as.numeric(age) + as.numeric(educ22) + as.numeric(unemdur), family=binomial(link="probit"),data=b,weights=as.numeric(fnlwgt)))
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1 & !is.na(D$educ222)),]
tab1 = table(D1$educ222)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$educ222)
UtoWWeduc = tab1/tab2
UtoWWeduc
D = b[which(b$unique_id %in% selected_id),]
D1 = D[which(D$year_id == 1 & !is.na(D$finc)),]
tab1 = table(D1$finc)
selected_id1 = corresp_id[which(lfsta_emp[,1] == "Unemployed" & b$year_id == 1)]
#UNEMP = b[which(b$lfsta_emp == "Unemployed" & b$year_id == 1),]
UNEMP = b[which(b$unique_id %in% selected_id1),]
tab2 = table(UNEMP$finc)
UtoWWfinc = tab1/tab2
UtoWWfinc
